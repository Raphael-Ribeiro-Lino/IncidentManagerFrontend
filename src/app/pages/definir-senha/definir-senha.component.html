<div class="auth-container">
    <!-- Lado Esquerdo: Banner Global -->
    <div class="auth-banner">
        <div class="auth-banner-content">
            <img src="assets/logo.png" alt="Logo Smartdesk" class="auth-logo">
            <p class="auth-subtitle">Gerencie chamados com eficiência e agilidade</p>
        </div>
    </div>

    <!-- Lado Direito: Card de Definição -->
    <div class="auth-content-wrapper">
        <div class="auth-card">
            <h2>Definir Senha</h2>
            <p class="auth-description">
                Escolha uma senha segura para proteger suas informações no Smartdesk.
            </p>

            <!-- Alertas -->
            <div *ngIf="errorMessages.length > 0" class="alert-box error">
                <div *ngFor="let msg of errorMessages">{{ msg }}</div>
            </div>

            <div *ngIf="successMessage" class="alert-box success">
                {{ successMessage }}
            </div>

            <form [formGroup]="formDefinePassword" (ngSubmit)="submitForm()" class="auth-form">

                <!-- Nova Senha -->
                <mat-form-field appearance="outline" class="full-width-field">
                    <mat-label>Nova Senha</mat-label>
                    <input matInput [type]="showPassword.newPassword ? 'text' : 'password'" 
                           formControlName="newPassword" placeholder="Mínimo 8 caracteres">
                    
                    <button mat-icon-button matSuffix type="button" (click)="togglePassword('newPassword')">
                        <mat-icon>{{ showPassword.newPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>

                    <!-- Lógica de Prioridade de Erros (1 por vez) -->
                    <mat-error *ngIf="formDefinePassword.get('newPassword')?.hasError('required')">
                        A senha é obrigatória.
                    </mat-error>

                    <mat-error *ngIf="!formDefinePassword.get('newPassword')?.hasError('required') && 
                                      (formDefinePassword.get('newPassword')?.hasError('minlength') || 
                                       formDefinePassword.get('newPassword')?.hasError('maxlength'))">
                        A senha deve ter entre 8 e 255 caracteres.
                    </mat-error>

                    <mat-error *ngIf="!formDefinePassword.get('newPassword')?.hasError('required') && 
                                      !formDefinePassword.get('newPassword')?.hasError('minlength') && 
                                      !formDefinePassword.get('newPassword')?.hasError('maxlength') && 
                                       formDefinePassword.get('newPassword')?.hasError('pattern')">
                        Use letras, números e caractere especial.
                    </mat-error>
                </mat-form-field>

                <!-- Confirmar Senha -->
                <mat-form-field appearance="outline" class="full-width-field">
                    <mat-label>Confirmar Senha</mat-label>
                    <input matInput [type]="showPassword.confirmPassword ? 'text' : 'password'" 
                           formControlName="confirmPassword" placeholder="Repita a senha">

                    <button mat-icon-button matSuffix type="button" (click)="togglePassword('confirmPassword')">
                        <mat-icon>{{ showPassword.confirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>

                    <mat-error *ngIf="formDefinePassword.get('confirmPassword')?.hasError('required')">
                        A confirmação é obrigatória.
                    </mat-error>
                    <mat-error *ngIf="formDefinePassword.get('confirmPassword')?.hasError('passwordMismatch')">
                        As senhas não coincidem.
                    </mat-error>
                </mat-form-field>

                <!-- Botão de Ação -->
                <button type="submit" class="btn btn-primary btn-auth-submit" 
                        [disabled]="formDefinePassword.invalid || isLoading">
                    <span *ngIf="!isLoading">Definir Senha</span>
                    <span *ngIf="isLoading" class="spinner-container">
                        <span class="spinner"></span> Enviando...
                    </span>
                </button>

            </form>

            <a class="auth-link-back" routerLink="/login">Voltar ao login</a>
        </div>
    </div>
</div>