<div class="usuario-page">
  <div class="usuario-card">
    <h1 class="usuario-title">Alterar Dados do Usuário</h1>

    <!-- Erros -->
    <div *ngIf="errorMessages.length" class="error-message">
      <div class="error" *ngFor="let msg of errorMessages">{{ msg }}</div>
    </div>

    <!-- Sucesso -->
    <div *ngIf="successfullyUpdatedUsuario" class="success">
      {{ successfullyUpdatedUsuario }}
    </div>

    <form *ngIf="formUsuario" [formGroup]="formUsuario" (ngSubmit)="submitForm()" class="usuario-form">

      <!-- Nome -->
      <div class="form-row">
        <div class="form-field full">
          <label class="label">Nome Completo *</label>
          <input class="input" formControlName="nome" />

          <div *ngIf="formUsuario.get('nome')?.touched && formUsuario.get('nome')?.invalid" class="error">
            <div *ngIf="formUsuario.get('nome')?.hasError('required')">O nome é obrigatório.</div>
            <div *ngIf="formUsuario.get('nome')?.hasError('maxlength')">Máximo de 100 caracteres.</div>
            <div *ngIf="formUsuario.get('nome')?.hasError('pattern')">Nome inválido. Use apenas letras, espaços ou hífen.</div>
          </div>
        </div>
      </div>

      <!-- E-mail -->
      <div class="form-row">
        <div class="form-field full">
          <label class="label">E-mail *</label>
          <input class="input" formControlName="email" />

          <div *ngIf="formUsuario.get('email')?.touched && formUsuario.get('email')?.invalid" class="error">
            <div *ngIf="formUsuario.get('email')?.hasError('required')">O e-mail é obrigatório.</div>
            <div *ngIf="formUsuario.get('email')?.hasError('maxlength')">Máximo de 320 caracteres.</div>
            <div *ngIf="formUsuario.get('email')?.hasError('pattern')">E-mail inválido.</div>
          </div>
        </div>
      </div>

      <!-- Telefone e Perfil -->
      <div class="form-row">

        <div class="form-field small">
          <label class="label">Telefone *</label>
          <input class="input" formControlName="telefone" placeholder="(11) 98765-4321" appMask="telefone" />

          <div *ngIf="formUsuario.get('telefone')?.touched && formUsuario.get('telefone')?.invalid" class="error">
            <div *ngIf="formUsuario.get('telefone')?.hasError('required')">Telefone obrigatório.</div>
            <div *ngIf="formUsuario.get('telefone')?.hasError('minlength') || formUsuario.get('telefone')?.hasError('maxlength')">
              Deve ter entre 10 e 15 caracteres.
            </div>
            <div *ngIf="formUsuario.get('telefone')?.hasError('pattern')">
              Telefone inválido!<br>Use um formato válido, como (11) 98765-4321 ou 11 98765-4321.
            </div>
          </div>
        </div>

        <div class="form-field small">
          <label class="label">Perfil *</label>
          <select class="input" formControlName="perfil">
            <option value="">Selecione</option>
            <option *ngFor="let p of perfilLabels | keyvalue" [value]="p.key">
              {{ p.value }}
            </option>
          </select>

          <div *ngIf="formUsuario.get('perfil')?.touched && formUsuario.get('perfil')?.invalid" class="error">
            <div *ngIf="formUsuario.get('perfil')?.hasError('required')">O perfil é obrigatório.</div>
          </div>
        </div>
      </div>

      <!-- Empresa -->
      <div class="form-row">
        <div class="form-field full">
          <label class="label">Empresa</label>
          <input class="input input-readonly" [value]="empresaSelecionada?.nome" readonly />
        </div>
      </div>

      <!-- Ativo -->
      <div class="form-row">
        <label class="checkbox">
          <input type="checkbox" formControlName="ativo" />
          Ativo
        </label>
      </div>

      <p class="text-muted">* Campos obrigatórios</p>

      <div class="actions">
        <button type="button" class="btn btn-ghost" (click)="cancelar()">Cancelar</button>
        <button type="submit" class="btn btn-primary" [disabled]="formUsuario.invalid">Salvar</button>
      </div>
    </form>
  </div>
</div>
