<div class="page-container">
    <div class="content-card">
        <h1 class="section-title">Alterar Senha</h1>

        <div *ngIf="errorMessages.length" class="alert-box error">
            <div *ngFor="let msg of errorMessages; let i = index" class="alert-item">
                <span class="alert-msg">{{ msg }}</span>
                <button type="button" class="btn-close-alert" (click)="removeErrorIndex(i)">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>

        <div *ngIf="successMessage" class="alert-box success">
            {{ successMessage }}
        </div>

        <form [formGroup]="formAlteraSenha" class="standard-form" (ngSubmit)="submitForm()">

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Senha Atual</mat-label>
                        <input matInput [type]="showPassword.senhaAtual ? 'text' : 'password'" 
                               formControlName="senhaAtual">
                        <button mat-icon-button matSuffix type="button" (click)="togglePassword('senhaAtual')">
                            <mat-icon>{{ showPassword.senhaAtual ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>

                        <mat-error *ngIf="formAlteraSenha.get('senhaAtual')?.hasError('required')">
                            A senha atual é obrigatória.
                        </mat-error>
                        <mat-error *ngIf="formAlteraSenha.get('senhaAtual')?.hasError('pattern')">
                            A senha deve conter letras, números e um caractere especial.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Nova Senha</mat-label>
                        <input matInput [type]="showPassword.novaSenha ? 'text' : 'password'" 
                               formControlName="novaSenha" placeholder="Mínimo 8 caracteres">
                        <button mat-icon-button matSuffix type="button" (click)="togglePassword('novaSenha')">
                            <mat-icon>{{ showPassword.novaSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>

                        <mat-error *ngIf="formAlteraSenha.get('novaSenha')?.hasError('required')">
                            A nova senha é obrigatória.
                        </mat-error>
                        
                        <mat-error *ngIf="!formAlteraSenha.get('novaSenha')?.hasError('required') && 
                                          (formAlteraSenha.get('novaSenha')?.hasError('minlength') || 
                                           formAlteraSenha.get('novaSenha')?.hasError('maxlength'))">
                            Mínimo de 8 caracteres.
                        </mat-error>

                        <mat-error *ngIf="!formAlteraSenha.get('novaSenha')?.hasError('required') && 
                                          !formAlteraSenha.get('novaSenha')?.hasError('minlength') && 
                                           formAlteraSenha.get('novaSenha')?.hasError('pattern')">
                            Use letras, números e caractere especial.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Repetir Nova Senha</mat-label>
                        <input matInput [type]="showPassword.repetirNovaSenha ? 'text' : 'password'" 
                               formControlName="repetirNovaSenha" placeholder="Confirme a senha">
                        <button mat-icon-button matSuffix type="button" (click)="togglePassword('repetirNovaSenha')">
                            <mat-icon>{{ showPassword.repetirNovaSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
                        </button>

                        <mat-error *ngIf="formAlteraSenha.get('repetirNovaSenha')?.hasError('required')">
                            Repetir a senha é obrigatório.
                        </mat-error>
                        <mat-error *ngIf="formAlteraSenha.get('repetirNovaSenha')?.hasError('passwordMismatch')">
                            As senhas não coincidem.
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <p class="text-muted small-text" style="margin-top: var(--space-sm);">* Campos obrigatórios</p>

            <div class="form-actions">
                <button class="btn btn-ghost" type="button" (click)="cancelar()">Cancelar</button>
                <button class="btn btn-primary" type="submit" [disabled]="formAlteraSenha.invalid || isLoading">
                    <span *ngIf="!isLoading">Salvar Senha</span>
                    <span *ngIf="isLoading" class="spinner-container">
                        <span class="spinner"></span> Salvando...
                    </span>
                </button>
            </div>

        </form>
    </div>
</div>