<div class="page-container">
    <div class="content-card">
        <h1 class="section-title">Cadastro de Empresa</h1>

        <div *ngIf="errorMessages.length > 0" class="alert-box error">
            <span class="alert-msg" *ngFor="let msg of errorMessages">{{ msg }}</span>
        </div>
        
        <div *ngIf="successfullyRegisteredEmpresa" class="alert-box success">
            {{ successfullyRegisteredEmpresa }}
        </div>

        <form [formGroup]="formEmpresa" class="standard-form" (ngSubmit)="submitForm()">

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Nome da Organização</mat-label>
                        <input matInput formControlName="nome" />
                        <mat-error *ngIf="formEmpresa.get('nome')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('nome')?.hasError('minlength')">O nome deve ter no mínimo 2 caracteres.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('nome')?.hasError('maxlength')">O nome deve ter no máximo 100 caracteres.</mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col small">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>CNPJ</mat-label>
                        <input matInput formControlName="cnpj" appMask="cnpj" placeholder="00.000.000/0000-00" />
                        <mat-error *ngIf="formEmpresa.get('cnpj')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('cnpj')?.hasError('invalidCnpj')">CNPJ inválido.</mat-error>
                    </mat-form-field>
                </div>

                <div class="form-col small" style="justify-content: center;">
                    <mat-checkbox formControlName="ativo" color="primary">Empresa Ativa</mat-checkbox>
                </div>
            </div>

            <div class="form-section-divider">Endereço</div>

            <div class="form-row">
                <div class="form-col small">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>CEP</mat-label>
                        <input matInput formControlName="cep" appMask="cep" placeholder="00000-000" maxlength="9" />
                        
                        <mat-icon matSuffix *ngIf="!isLoading">location_on</mat-icon>
                        <mat-spinner matSuffix *ngIf="isLoading && formEmpresa.get('cep')?.value?.length >= 8"></mat-spinner>

                        <mat-error *ngIf="formEmpresa.get('cep')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('cep')?.hasError('cepNaoEncontrado')">CEP não encontrado.</mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Rua / Logradouro</mat-label>
                        <input matInput formControlName="rua" />
                        <mat-error *ngIf="formEmpresa.get('rua')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('rua')?.hasError('maxlength')">Máximo 120 caracteres.</mat-error>
                    </mat-form-field>
                </div>

                <div class="form-col x-small">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Nº</mat-label>
                        <input matInput formControlName="numero" />
                        <mat-error *ngIf="formEmpresa.get('numero')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('numero')?.hasError('maxlength')">Máximo 10 caracteres.</mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Complemento</mat-label>
                        <input matInput formControlName="complemento" />
                        <mat-error *ngIf="formEmpresa.get('complemento')?.hasError('maxlength')">Máximo 50 caracteres.</mat-error>
                    </mat-form-field>
                </div>

                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Bairro</mat-label>
                        <input matInput formControlName="bairro" />
                        <mat-error *ngIf="formEmpresa.get('bairro')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('bairro')?.hasError('maxlength')">Máximo 80 caracteres.</mat-error>
                    </mat-form-field>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col full">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>Cidade</mat-label>
                        <input matInput formControlName="cidade" />
                        <mat-error *ngIf="formEmpresa.get('cidade')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('cidade')?.hasError('maxlength')">Máximo 80 caracteres.</mat-error>
                    </mat-form-field>
                </div>

                <div class="form-col small">
                    <mat-form-field appearance="outline" class="full-width-field">
                        <mat-label>UF</mat-label>
                        <input matInput formControlName="estado" maxlength="2" appMask="uf" />
                        <mat-error *ngIf="formEmpresa.get('estado')?.hasError('required')">Obrigatório.</mat-error>
                        <mat-error *ngIf="formEmpresa.get('estado')?.hasError('minlength')">Mínimo 2 caracteres.</mat-error>
                    </mat-form-field>
                </div>
            </div>

            <p class="text-muted small-text">* Campos obrigatórios</p>

            <div class="form-actions">
                <button class="btn btn-ghost" type="button" (click)="cancelar()">
                    Cancelar
                </button>

                <button class="btn btn-primary" type="submit" [disabled]="formEmpresa.invalid || isLoading">
                    <span *ngIf="!isLoading">Salvar Empresa</span>
                    <span *ngIf="isLoading" class="spinner-container">
                        <span class="spinner"></span> Salvando...
                    </span>
                </button>
            </div>

        </form>
    </div>
</div>